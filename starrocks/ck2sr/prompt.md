项目概述
项目名称：ck2sr

项目目标：将指定 ClickHouse 数据库中的数据高效、可靠、完整地同步到 StarRocks 数据库中。该服务应具备分布式部署能力，能够在生产环境中稳定运行。

技术栈与环境
项目语言： Go 1.25.1

构建管理： go mod

目标平台： Linux amd64

数据库版本：

ClickHouse: 23.2.5.107

StarRocks: 4.0

部署环境： Kubernetes (支持分布式部署)

核心功能需求
策略驱动的数据同步：

通过独立的配置文件（例如，YAML 或 JSON）定义数据同步任务。

流量控制： 支持配置全局或任务级别的**每秒最大数据量（例如 MB/s）**限制。

并发控制： 支持配置最大并发同步任务数和单个任务的最大并发线程数。

时间窗口限制： 支持配置任务可执行的时间段（例如，仅在凌晨 1:00 到 5:00 之间运行）。

数据范围限定： 支持指定源表和目的表，并允许基于时间列（例如，create_time）限定要同步的数据时间范围。

任务生命周期管理与持久化：

状态持久化： 任务状态（如已同步数据量、断点信息）必须持久化到磁盘或外部存储（如 etcd），以支持服务重启后的断点续传。

任务状态监控： 提供 API 或命令行工具，实时查看任务状态，包括：

需要同步的总数据量（或行数）。

已同步的数据量（或行数）。

当前的 IO 吞吐速率（MB/s 或 行/s）。

已耗时。

预计剩余用时。

操作控制： 提供对正在运行的任务的暂停、继续和取消功能。

数据完整性与可靠性：

完整性校验： 任务完成后，必须提供数据完整性校验能力，例如通过对比源表和目的表的行数或某个时间范围内的聚合校验和。

错误处理与重试： 健壮的错误处理机制，支持对网络中断或数据库错误的可配置重试策略。

架构设计与扩展性：

模块化设计： 采用清晰的模块化架构，将配置解析、任务调度、数据读写、状态管理、指标监控等核心功能解耦。

可扩展性：

设计数据处理管道（Pipeline），支持通过插件或接口的方式扩展**数据过滤（Data Filtering）和数据转换/修改（Data Transformation）**能力。

分布式协同：

项目需支持在 Kubernetes 环境下以多个 Pod 实例部署。

通过分布式锁或任务分片机制确保多个实例协同工作，避免重复同步任务。

共享任务队列的设计，以实现任务的水平扩展和负载均衡。

编码要求
语言标准： 使用 Go 1.25.1，遵循官方编码规范。

模块化： 项目结构清晰，各模块职责单一。例如，pkg/, internal/, cmd/ 等标准 Go 项目布局。

注释： 采用中文注释，为所有公共函数、结构体、接口和重要代码段提供清晰的说明，解释其功能、参数、返回值和使用注意事项。

单元测试： 为核心业务逻辑和关键模块编写全面的单元测试，确保代码质量和功能正确性。

性能优化：

低消耗，高性能：在数据同步过程中，优先使用零拷贝技术和缓冲池，减少内存分配和 GC 压力。

并发模型： 利用 Go 的 goroutine 和 channel 实现高效的并发数据读写。

产出内容
请按以下目录结构和内容要求生成代码：

main.go： 服务启动入口，负责配置加载和初始化。

internal/： 核心业务逻辑实现，包括：

config/： 配置加载与解析。

scheduler/： 任务调度与协调。

worker/： 实际数据同步执行单元。

storage/： 任务状态持久化接口与实现。

pipeline/： 数据处理管道接口与实现。

pkg/： 可复用的库代码，如数据库连接、工具函数等。

tests/： 单元测试。

configs/： 配置文件示例。

go.mod & go.sum： Go 模块依赖文件。

README.md： 项目说明文档，包含项目简介、安装、配置和使用说明。
