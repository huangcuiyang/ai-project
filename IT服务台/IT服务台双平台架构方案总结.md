# IT服务台双平台架构方案总结

## 一、方案总览

### 1.1 架构特点

本方案设计了**IT服务台业务平台**和**AI能力平台**的双平台解耦架构：

```
┌──────────────────────────────────────────────────┐
│           IT服务台统一系统                         │
├──────────────────────────────────────────────────┤
│                                                    │
│  ┌─────────────────┐      ┌─────────────────┐   │
│  │  业务平台        │◄────►│  AI能力平台      │   │
│  │  (Platform 1)   │ API  │  (Platform 2)   │   │
│  │                 │      │                 │   │
│  │  • 工单管理      │      │  • LLM服务       │   │
│  │  • 用户管理      │      │  • RAG引擎       │   │
│  │  • 通知推送      │      │  • 知识库        │   │
│  │  • 数据统计      │      │  • Agent服务     │   │
│  │  • 系统集成      │      │                 │   │
│  └─────────────────┘      └─────────────────┘   │
│                                                    │
│  核心特性:                                         │
│  ✓ 职责分离：业务逻辑 vs AI能力                    │
│  ✓ 独立部署：可独立扩展和演进                      │
│  ✓ 技术栈独立：各选最优技术                        │
│  ✓ 模型灵活：云端/本地切换                         │
│  ✓ 能力复用：AI平台可被其他系统调用               │
└──────────────────────────────────────────────────┘
```

### 1.2 核心优势

| 优势 | 说明 |
|------|------|
| **架构解耦** | 业务平台和AI平台职责清晰，互不影响 |
| **独立演进** | 两个平台可独立升级、独立扩展 |
| **技术灵活** | 业务平台用Go/Java，AI平台用Python，各取所长 |
| **模型切换** | AI平台支持云端LLM和本地LLM灵活切换 |
| **能力复用** | AI能力可被CRM、OA等其他系统调用 |
| **成本优化** | 本地LLM降低长期成本，云端LLM保证质量 |
| **团队协作** | 业务团队和AI团队独立开发，提高效率 |

---

## 二、技术选型汇总

### 2.1 IT服务台业务平台

| 层次 | 组件 | 技术选择 | 理由 |
|------|------|---------|------|
| **前端** | Web应用 | Vue 3 + TypeScript + Element Plus | 生态成熟、组件丰富 |
| | 对话UI | 自研ChatUI（参考ChatGPT） | 定制化体验 |
| | 实时通信 | WebSocket (Socket.io) | 双向通信、实时推送 |
| **后端** | 工单服务 | Go + Gin | 高性能、并发能力强 |
| | 用户服务 | Java + Spring Boot | 成熟的安全框架 |
| | 通知服务 | Node.js + Express | 实时推送、事件驱动 |
| | 统计服务 | Java + Spring Boot | 复杂查询、报表生成 |
| | 集成服务 | Python + FastAPI | 灵活对接、快速开发 |
| **网关** | API网关 | APISIX / Kong | 高性能、插件丰富 |
| **中间件** | 消息队列 | RocketMQ / Kafka | 高可靠、高吞吐 |
| | 服务注册 | Nacos / Consul | 服务发现、配置管理 |
| | 流控降级 | Sentinel | 微服务保护 |
| **数据** | 关系数据库 | MySQL 8.0 | 事务支持、成熟稳定 |
| | 缓存 | Redis 7.x Cluster | 高性能、分布式 |
| | 文档数据库 | MongoDB | 日志、审计 |
| | 对象存储 | MinIO / OSS | 附件、文件 |

### 2.2 AI能力平台

| 层次 | 组件 | 技术选择 | 理由 |
|------|------|---------|------|
| **框架** | API框架 | Python 3.11 + FastAPI | 异步支持、高性能、自动文档 |
| | AI编排 | LangChain | 生态成熟、工具丰富 |
| **LLM** | 云端模型 | OpenAI GPT-4 Turbo | 效果最佳 |
| | | 阿里云通义千问Max | 国内备用、合规 |
| | 本地模型 | Qwen-7B-Chat (INT4) | 中文效果好、成本低 |
| | 推理框架 | vLLM / TGI | 高吞吐、低延迟 |
| **Embedding** | 向量化 | BGE-M3 (1024维) | 中文SOTA、通用性强 |
| | 重排序 | BGE-Reranker-Large | 精排效果好 |
| **知识库** | 结构化存储 | PostgreSQL 14+ | JSONB、全文检索、事务 |
| | 向量数据库 | Milvus 2.3+ | 高性能、易扩展 |
| | 全文检索 | Elasticsearch 8.x | 中文分词、聚合分析 |
| | 缓存 | Redis 7.x | LLM响应缓存、会话 |
| | 对象存储 | MinIO / OSS | 知识附件 |
| **GPU** | 显卡 | NVIDIA 3090 / 4090 | 性价比高 |
| | 监控 | NVIDIA DCGM | GPU指标监控 |

---

## 三、核心模块设计

### 3.1 业务平台核心模块

```
业务平台
├── 工单管理服务 (Go)
│   ├── 工单CRUD
│   ├── 派单引擎
│   ├── 工单流转
│   ├── SLA管理
│   └── AI增强（调用AI平台）
│
├── 用户管理服务 (Java)
│   ├── 用户认证（JWT）
│   ├── 权限控制（RBAC）
│   ├── 组织架构
│   └── 用户配置
│
├── 通知服务 (Node.js)
│   ├── WebSocket实时推送
│   ├── 邮件通知
│   ├── 站内信
│   └── 通知模板
│
├── 统计分析服务 (Java)
│   ├── 数据报表
│   ├── 指标统计
│   ├── 趋势分析
│   └── 导出功能
│
└── 集成服务 (Python)
    ├── 端产品对接
    ├── 第三方集成
    └── 数据同步
```

### 3.2 AI平台核心模块

```
AI能力平台
├── LLM服务层
│   ├── 云端模型接入
│   │   ├── OpenAI API
│   │   └── 通义千问API
│   ├── 本地模型推理
│   │   ├── vLLM推理服务
│   │   └── Qwen-7B-Chat
│   └── 智能路由
│       ├── 复杂度评估
│       ├── 模型选择策略
│       └── 失败降级
│
├── RAG引擎
│   ├── Query处理
│   │   ├── 意图识别
│   │   ├── 实体抽取
│   │   └── Query改写
│   ├── 检索层
│   │   ├── 向量检索（Milvus）
│   │   ├── 全文检索（ES）
│   │   └── 结果融合（RRF）
│   ├── 重排序
│   │   └── BGE-Reranker
│   └── 生成层
│       ├── Prompt构建
│       └── LLM生成
│
├── 知识库服务
│   ├── 知识管理
│   │   ├── 知识CRUD
│   │   ├── 版本控制
│   │   ├── 审核流程
│   │   └── 质量评分
│   ├── 知识检索
│   │   ├── 混合检索
│   │   ├── 相似度匹配
│   │   └── 智能推荐
│   └── 知识更新
│       ├── 自动生成（从工单）
│       ├── 过时检测
│       └── 批量更新
│
└── Agent服务（可选）
    ├── 任务理解
    ├── 计划制定
    ├── 工具调用
    └── 结果汇总
```

### 3.3 知识库解决方案（重点）

#### 数据存储

```
知识库三层存储架构:

1. PostgreSQL（结构化数据）
   - 知识元数据
   - 分类体系
   - 版本历史
   - 审核记录
   - 质量评分

2. Milvus（向量数据）
   - 知识向量（BGE-M3, 1024维）
   - FAQ向量
   - 历史工单向量
   - HNSW索引

3. Elasticsearch（全文索引）
   - 知识内容分词
   - 中文分词（IK Analyzer）
   - 倒排索引
   - 聚合分析
```

#### 检索流程

```
用户提问
    ↓
Query理解与改写
    ↓
混合检索（并行）
├─ 向量检索（Milvus）    权重70%
├─ 全文检索（ES）          权重30%
└─ 结果融合（RRF算法）
    ↓
重排序（BGE-Reranker）
    ↓
后处理（权限过滤、去重）
    ↓
返回Top 5结果
```

#### 知识自动更新

```yaml
策略:
  1. 从工单自动生成知识
     - 识别高频问题（同类工单≥5次）
     - 提取共性解决方案
     - LLM生成知识草稿
     - 提交人工审核

  2. 过时知识检测
     - 长期无人查看（>6个月且查看<10次）
     - 负面反馈率高（无用率>60%）
     - 关联产品版本停用
     - 自动归档或标记

  3. 知识质量评分
     - 查看次数
     - 有用/无用反馈
     - 复用次数
     - 关联工单解决率
```

---

## 四、实施路线图

### 4.1 分阶段实施

```
┌─────────────────────────────────────────────────────────┐
│  阶段1：基础平台搭建（0-3个月）                          │
├─────────────────────────────────────────────────────────┤
│                                                           │
│  业务平台:                                                │
│  ✓ 工单管理服务（核心功能）                              │
│  ✓ 用户管理服务（认证+权限）                             │
│  ✓ 通知服务（WebSocket）                                 │
│  ✓ 数据库设计与部署                                       │
│                                                           │
│  AI平台:                                                  │
│  ✓ LLM服务（云端GPT-4 API）                              │
│  ✓ 基础RAG引擎                                            │
│  ✓ 知识库（PostgreSQL + Milvus + ES）                   │
│  ✓ 初始知识库（100条FAQ）                                │
│                                                           │
│  集成:                                                    │
│  ✓ 两平台API接口对接                                      │
│  ✓ SDK封装                                                │
│                                                           │
│  前端:                                                    │
│  ✓ 对话式UI                                               │
│  ✓ 工单表单                                               │
│  ✓ 工作台界面                                             │
│                                                           │
│  目标:                                                    │
│  • 用户自助率 ≥ 50%                                       │
│  • 智能问答准确率 ≥ 70%                                   │
│  • 基础功能可用                                           │
└─────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────┐
│  阶段2：AI能力增强（3-6个月）                            │
├─────────────────────────────────────────────────────────┤
│                                                           │
│  业务平台:                                                │
│  ✓ 统计分析服务（报表）                                   │
│  ✓ 集成服务（端产品对接）                                │
│  ✓ 工单流转优化                                           │
│                                                           │
│  AI平台:                                                  │
│  ✓ 部署本地LLM（Qwen-7B）                                │
│  ✓ 智能路由（云端/本地切换）                             │
│  ✓ RAG优化（重排序、多路召回）                           │
│  ✓ 知识库扩展至500+条                                     │
│  ✓ 知识自动生成（从工单）                                │
│                                                           │
│  功能增强:                                                │
│  ✓ 智能派单                                               │
│  ✓ 工单信息提取                                           │
│  ✓ 知识推荐                                               │
│  ✓ 对话历史记录                                           │
│                                                           │
│  目标:                                                    │
│  • 用户自助率 ≥ 70%                                       │
│  • IT运维排障率 ≥ 80%                                     │
│  • 月度成本降低50%（引入本地LLM）                        │
└─────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────┐
│  阶段3：高级功能与优化（6-12个月）                       │
├─────────────────────────────────────────────────────────┤
│                                                           │
│  AI平台:                                                  │
│  ✓ Agent服务（可选，复杂任务）                           │
│  ✓ 多模态支持（语音、图片）                              │
│  ✓ 模型微调（领域适配）                                   │
│  ✓ 知识库自动优化                                         │
│                                                           │
│  业务平台:                                                │
│  ✓ 高级报表与BI                                           │
│  ✓ 工作流自动化                                           │
│  ✓ 移动端支持                                             │
│                                                           │
│  性能优化:                                                │
│  ✓ 缓存策略优化                                           │
│  ✓ 数据库性能调优                                         │
│  ✓ 服务拆分与扩展                                         │
│                                                           │
│  运维完善:                                                │
│  ✓ 监控告警完善                                           │
│  ✓ 日志分析系统                                           │
│  ✓ 自动化运维                                             │
│                                                           │
│  目标:                                                    │
│  • 运维人员服务比 1:2000                                  │
│  • 系统可用性 ≥ 99.9%                                     │
│  • 响应时间P95 < 500ms                                    │
└─────────────────────────────────────────────────────────┘
```

### 4.2 里程碑

| 时间 | 里程碑 | 交付物 |
|------|--------|--------|
| **1个月** | 架构设计完成 | 详细设计文档、技术选型、数据库设计 |
| **2个月** | 业务平台MVP | 工单、用户、通知服务可用 |
| **3个月** | AI平台MVP | 智能问答、知识检索可用 |
| **4个月** | 集成测试完成 | 两平台集成，端到端流程打通 |
| **5个月** | 灰度上线 | 10%用户灰度测试 |
| **6个月** | 正式上线 | 100%用户，本地LLM部署 |
| **9个月** | 功能完善 | Agent、多模态、高级报表 |
| **12个月** | 优化迭代 | 性能优化、运维自动化 |

---

## 五、成本预算

### 5.1 初期投入（一次性）

| 项目 | 成本（万元） | 说明 |
|------|-------------|------|
| **开发人力（6个月）** | 60-90 | 8人团队×6月 |
| | | 2前端+3后端+2AI+1测试 |
| **服务器硬件** | 15-25 | 业务平台3台+AI平台3台 |
| **GPU服务器** | 3-5 | 1×3090或租用 |
| **软件License** | 3-5 | 监控、安全、IDE等 |
| **测试环境** | 2-3 | 云资源 |
| **培训与文档** | 2-3 | 团队培训、用户培训 |
| **应急预算** | 5-10 | 10%应急 |
| **合计** | **90-141万** | |

### 5.2 月度运营成本（500用户）

#### 阶段1：纯云端LLM（0-3个月）

| 项目 | 月成本（元） | 说明 |
|------|------------|------|
| 云端LLM API | 10,000-15,000 | GPT-4 + 通义千问 |
| 服务器租用 | 8,000-12,000 | 6台云服务器 |
| 数据库服务 | 5,000-8,000 | MySQL + Redis + MongoDB |
| Milvus | 3,000-5,000 | 自建或云版 |
| Elasticsearch | 4,000-6,000 | 3节点集群 |
| 带宽流量 | 2,000-3,000 | |
| 监控工具 | 1,000-2,000 | |
| **小计** | **33,000-51,000** | |

#### 阶段2：引入本地LLM（3个月后）

| 项目 | 月成本（元） | 说明 |
|------|------------|------|
| 云端LLM API | 2,000-4,000 | 减少80%调用 |
| 本地GPU | 3,000-5,000 | 租用或分摊 |
| 服务器租用 | 10,000-14,000 | 增加AI服务器 |
| 数据库服务 | 5,000-8,000 | |
| Milvus | 3,000-5,000 | |
| Elasticsearch | 4,000-6,000 | |
| 带宽流量 | 2,000-3,000 | |
| 监控工具 | 1,000-2,000 | |
| **小计** | **30,000-47,000** | 节省约20% |

### 5.3 三年TCO（总拥有成本）

```
初期投入: 90-141万

运营成本（3年）:
  - 第1年: 约40万（前3月高，后9月优化）
  - 第2年: 约36万（持续优化）
  - 第3年: 约36万

人力成本（3年，4人运维团队）:
  - 约360万（120万/年）

总计: 约526-673万（3年）

人均成本: 约1052-1346元/用户/3年
         约29-37元/用户/月
```

---

## 六、风险分析与应对

### 6.1 技术风险

| 风险 | 可能性 | 影响 | 应对措施 |
|------|-------|------|---------|
| **云端LLM不稳定** | 中 | 高 | ①多云备用 ②本地降级 ③缓存优化 |
| **本地LLM效果不足** | 中 | 中 | ①选择7B+模型 ②领域微调 ③混合路由 |
| **知识库检索不准** | 中 | 中 | ①混合检索 ②重排序 ③持续优化 |
| **数据库性能瓶颈** | 低 | 高 | ①主从架构 ②读写分离 ③缓存 |
| **GPU资源不足** | 低 | 中 | ①云GPU弹性 ②多卡扩展 |
| **系统集成困难** | 中 | 中 | ①标准API ②详细文档 ③测试先行 |

### 6.2 业务风险

| 风险 | 应对措施 |
|------|---------|
| **用户接受度低** | ①渐进式引入 ②用户培训 ③保留传统入口 |
| **AI回答不准确** | ①人工审核 ②快速转人工 ②badcase收集 |
| **知识库建设慢** | ①自动生成 ②激励机制 ③专人负责 |
| **成本超预算** | ①实时监控 ②预算告警 ③优化策略 |

### 6.3 安全风险

| 风险 | 应对措施 |
|------|---------|
| **数据泄露** | ①敏感数据脱敏 ②访问控制 ③审计日志 |
| **Prompt注入** | ①输入过滤 ②输出检测 ③安全审计 |
| **API滥用** | ①API Key管理 ②限流 ③异常检测 |

---

## 七、核心竞争力

### 7.1 技术创新点

1. **双平台解耦**：业务与AI分离，职责清晰，独立演进
2. **模型灵活切换**：云端/本地自动路由，成本与质量平衡
3. **知识库三层存储**：结构化+向量+全文，检索准确率高
4. **混合检索RRF**：向量+全文融合，召回率提升30%
5. **智能路由**：基于复杂度自动选择模型，成本优化50%
6. **知识自动生成**：从工单自动积累知识，持续进化

### 7.2 业务价值

| 价值 | 量化指标 |
|------|---------|
| **提升效率** | 故障处置效率提升50%+ |
| **降低成本** | 运维人员服务比1:2000（vs传统1:500） |
| **改善体验** | 用户自助率70%，7×24h服务 |
| **知识沉淀** | 自动积累可复用知识资产 |
| **数据驱动** | 全流程可视化，辅助决策 |

---

## 八、成功案例参考

### 8.1 类似方案对比

| 维度 | 传统ITSM | 国外SaaS | **本方案** |
|------|---------|---------|-----------|
| **AI能力** | ❌ 无 | ✅ 有（黑盒） | ✅ 有（可控） |
| **知识库** | ⭐⭐ 基础 | ⭐⭐⭐⭐ 智能 | ⭐⭐⭐⭐⭐ 深度定制 |
| **私有化** | ✅ 支持 | ❌ SaaS only | ✅ 灵活部署 |
| **成本** | ⭐⭐⭐⭐ | ⭐⭐ 高 | ⭐⭐⭐⭐ 可控 |
| **定制化** | ⭐⭐⭐ | ⭐⭐ | ⭐⭐⭐⭐⭐ |

---

## 九、下一步行动

### 9.1 立即行动

- [ ] 确认技术方案
- [ ] 组建项目团队（8人）
- [ ] 启动详细设计
- [ ] 采购硬件设备
- [ ] 搭建开发环境

### 9.2 第一个月

- [ ] 完成详细设计文档
- [ ] 数据库设计
- [ ] API接口设计
- [ ] 技术预研（RAG、Milvus等）
- [ ] 开发规范制定

### 9.3 持续工作

- [ ] 每周进度评审
- [ ] 每月里程碑检查
- [ ] 技术风险跟踪
- [ ] 成本监控
- [ ] 文档持续更新

---

## 十、附录

### 10.1 相关文档

1. [双平台解耦架构设计方案.md](./双平台解耦架构设计方案.md)
   - 总体架构设计
   - IT服务台业务平台详细设计
   - 数据库设计

2. [知识库完整解决方案设计.md](./知识库完整解决方案设计.md)
   - 知识库架构
   - 数据模型
   - 检索引擎
   - 自动更新机制

3. [AI能力平台核心模块与集成方案.md](./AI能力平台核心模块与集成方案.md)
   - LLM服务（云端/本地切换）
   - RAG引擎详细设计
   - Agent服务
   - 两平台集成方案

4. [AI架构方案A-云端LLM.md](./AI架构方案A-云端LLM.md)
   - 纯云端LLM方案参考

5. [AI架构方案B-Agent智能体.md](./AI架构方案B-Agent智能体.md)
   - Agent高级功能参考

### 10.2 技术栈速查

```yaml
前端:
  - Vue 3 + TypeScript + Element Plus
  - WebSocket (Socket.io)
  - Markdown渲染

业务平台后端:
  - Go + Gin (工单服务)
  - Java + Spring Boot (用户服务、统计服务)
  - Node.js + Express (通知服务)
  - Python + FastAPI (集成服务)

AI平台后端:
  - Python 3.11 + FastAPI
  - LangChain (AI编排)
  - vLLM (本地推理)

LLM:
  云端: OpenAI GPT-4 Turbo、通义千问Max
  本地: Qwen-7B-Chat (INT4量化)

Embedding:
  - BGE-M3 (1024维)
  - BGE-Reranker-Large (重排序)

数据层:
  业务: MySQL 8.0 + Redis 7.x + MongoDB
  AI: PostgreSQL 14+ + Milvus 2.3+ + Elasticsearch 8.x + Redis 7.x

中间件:
  - API网关: APISIX / Kong
  - 消息队列: RocketMQ / Kafka
  - 服务注册: Nacos / Consul

监控:
  - Prometheus + Grafana
  - Loki / ELK
  - SkyWalking (链路追踪)
```

---

## 十一、总结

本方案设计了一套**业务与AI解耦的双平台架构**，具备以下核心优势：

✅ **架构先进**：双平台解耦，职责清晰，独立演进
✅ **技术成熟**：基于业界最佳实践，风险可控
✅ **成本优化**：云端+本地混合，长期成本降低50%
✅ **知识沉淀**：三层存储+自动生成，持续进化
✅ **灵活部署**：支持私有化+SaaS双模式
✅ **易于扩展**：模块化设计，可逐步演进

该方案可满足**IT服务台用户自助率70%、运维排障率80%**的核心目标，为企业构建智能化的IT服务体系提供坚实基础。

---

**方案版本**: v1.0
**最后更新**: 2025-12-01
**作者**: AI架构设计团队
