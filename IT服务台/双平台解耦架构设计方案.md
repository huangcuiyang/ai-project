# IT服务台双平台解耦架构设计方案

## 一、架构总览

### 1.1 双平台架构图

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          前端层（统一用户界面）                            │
│  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐     │
│  │  User门户         │  │  工程师工作台     │  │  管理后台         │     │
│  │  - 对话式交互     │  │  - 工单处理       │  │  - 数据报表       │     │
│  │  - 工单提交       │  │  - AI助手         │  │  - 知识库管理     │     │
│  │  - 进度查询       │  │  - 知识推荐       │  │  - 系统配置       │     │
│  └──────────────────┘  └──────────────────┘  └──────────────────┘     │
└─────────────────────────────────────────────────────────────────────────┘
           ↓                        ↓                        ↓
┌─────────────────────────────────────────────────────────────────────────┐
│                          API网关 / BFF层                                 │
│  - 统一鉴权                                                               │
│  - 请求路由（业务API / AI API）                                          │
│  - 协议转换                                                               │
│  - 限流熔断                                                               │
└─────────────────────────────────────────────────────────────────────────┘
           ↓                                                    ↓
┌────────────────────────────────┐        ┌────────────────────────────────┐
│  IT服务台业务平台（Platform 1） │        │   AI能力平台（Platform 2）      │
│  ════════════════════════════  │        │  ════════════════════════════  │
│                                │        │                                │
│  核心业务模块：                 │◄─────►│  核心AI能力：                   │
│  ┌──────────────────────┐      │ HTTPS│  ┌──────────────────────┐     │
│  │  工单管理服务         │      │  REST │  │  对话编排服务         │     │
│  │  - 工单CRUD          │      │  API  │  │  - 意图识别           │     │
│  │  - 工单流转           │      │       │  │  - 多轮对话           │     │
│  │  - 派单引擎           │      │       │  │  - 上下文管理         │     │
│  └──────────────────────┘      │       │  └──────────────────────┘     │
│  ┌──────────────────────┐      │       │  ┌──────────────────────┐     │
│  │  用户管理服务         │      │       │  │  LLM服务层            │     │
│  │  - 用户认证           │      │       │  │  - 云端模型API        │     │
│  │  - 权限控制           │      │       │  │  - 本地模型推理       │     │
│  │  - 组织架构           │      │       │  │  - 模型路由策略       │     │
│  └──────────────────────┘      │       │  └──────────────────────┘     │
│  ┌──────────────────────┐      │       │  ┌──────────────────────┐     │
│  │  通知服务             │      │       │  │  RAG引擎              │     │
│  │  - 消息推送           │      │       │  │  - 查询重写           │     │
│  │  - 邮件通知           │      │       │  │  - 混合检索           │     │
│  │  - 站内信             │      │       │  │  - 重排序             │     │
│  └──────────────────────┘      │       │  └──────────────────────┘     │
│  ┌──────────────────────┐      │       │  ┌──────────────────────┐     │
│  │  统计分析服务         │      │       │  │  知识库服务           │     │
│  │  - 数据报表           │      │       │  │  - 知识CRUD           │     │
│  │  - 指标统计           │      │       │  │  - 向量化             │     │
│  │  - 趋势分析           │      │       │  │  - 版本管理           │     │
│  └──────────────────────┘      │       │  └──────────────────────┘     │
│  ┌──────────────────────┐      │       │  ┌──────────────────────┐     │
│  │  集成服务             │      │       │  │  Agent服务（可选）    │     │
│  │  - 端产品对接         │      │       │  │  - 工具编排           │     │
│  │  - 第三方集成         │      │       │  │  - 多步推理           │     │
│  │  - 数据同步           │      │       │  │  - 自主决策           │     │
│  └──────────────────────┘      │       │  └──────────────────────┘     │
│                                │        │                                │
│  数据层：                       │        │  数据层：                       │
│  ┌──────────────────────┐      │        │  ┌──────────────────────┐     │
│  │  MySQL（业务数据）    │      │        │  │  Milvus（向量库）     │     │
│  │  - 工单表             │      │        │  │  - 知识向量           │     │
│  │  - 用户表             │      │        │  │  - 历史对话向量       │     │
│  │  - 配置表             │      │        │  └──────────────────────┘     │
│  └──────────────────────┘      │        │  ┌──────────────────────┐     │
│  ┌──────────────────────┐      │        │  │  Elasticsearch        │     │
│  │  Redis（缓存）        │      │        │  │  - 知识全文索引       │     │
│  │  - 会话缓存           │      │        │  │  - 问题日志           │     │
│  │  - 工单缓存           │      │        │  └──────────────────────┘     │
│  └──────────────────────┘      │        │  ┌──────────────────────┐     │
│  ┌──────────────────────┐      │        │  │  PostgreSQL           │     │
│  │  MongoDB（日志）      │      │        │  │  - 知识库结构化数据   │     │
│  │  - 操作日志           │      │        │  │  - 对话历史           │     │
│  │  - 审计日志           │      │        │  │  - 模型配置           │     │
│  └──────────────────────┘      │        │  └──────────────────────┘     │
│                                │        │  ┌──────────────────────┐     │
│                                │        │  │  Redis（AI缓存）      │     │
│                                │        │  │  - LLM响应缓存        │     │
│                                │        │  │  - 对话上下文         │     │
│                                │        │  └──────────────────────┘     │
└────────────────────────────────┘        └────────────────────────────────┘
```

### 1.2 交互流程示例

#### 场景1：用户发起智能问答

```
用户 → 前端 → API网关 → AI能力平台
                             ↓
                       1. 对话编排服务
                             ↓
                       2. RAG引擎（检索知识）
                             ↓
                       3. LLM服务（生成回答）
                             ↓
                       前端 ← 返回答案
```

#### 场景2：用户提交工单

```
用户 → 前端 → API网关 → AI能力平台（提取工单信息）
                             ↓
                       AI返回结构化数据
                             ↓
                       IT服务台业务平台
                             ↓
                       1. 工单管理服务（创建工单）
                             ↓
                       2. 通知服务（通知工程师）
                             ↓
                       前端 ← 返回工单编号
```

#### 场景3：工程师处理工单

```
工程师 → 前端 → API网关 → IT服务台业务平台
                             ↓
                       1. 工单管理服务（查询工单）
                             ↓
                       前端展示工单详情
                             ↓
                       工程师点击"AI推荐解决方案"
                             ↓
                       API网关 → AI能力平台
                             ↓
                       RAG引擎（检索相似问题）
                             ↓
                       前端 ← 返回推荐方案
```

### 1.3 架构优势

| 优势 | 说明 |
|------|------|
| **职责分离** | 业务逻辑与AI能力解耦，各司其职 |
| **独立部署** | 两个平台可独立部署、独立扩展 |
| **技术栈独立** | 业务平台用Java/Go，AI平台用Python |
| **能力复用** | AI平台可被其他系统调用（如CRM、OA） |
| **灵活切换** | AI平台模型可云端/本地灵活切换 |
| **安全隔离** | 业务数据与AI数据物理隔离 |
| **团队协作** | 业务团队和AI团队独立开发 |

---

## 二、IT服务台业务平台详细设计

### 2.1 技术架构

```
┌─────────────────────────────────────────────────────────┐
│              IT服务台业务平台架构                          │
├─────────────────────────────────────────────────────────┤
│                                                           │
│  接入层:                                                  │
│  ┌────────────────────────────────────────────────┐     │
│  │  API Gateway (APISIX / Kong)                   │     │
│  │  - 路由转发                                     │     │
│  │  - 统一鉴权 (JWT)                               │     │
│  │  - 限流熔断                                     │     │
│  │  - 日志记录                                     │     │
│  └────────────────────────────────────────────────┘     │
│                                                           │
│  应用层:                                                  │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
│  │  工单服务    │  │  用户服务    │  │  通知服务    │     │
│  └─────────────┘  └─────────────┘  └─────────────┘     │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
│  │  统计服务    │  │  集成服务    │  │  配置服务    │     │
│  └─────────────┘  └─────────────┘  └─────────────┘     │
│                                                           │
│  数据层:                                                  │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
│  │  MySQL      │  │  Redis      │  │  MongoDB    │     │
│  │  主从架构    │  │  Cluster    │  │  副本集     │     │
│  └─────────────┘  └─────────────┘  └─────────────┘     │
│                                                           │
│  中间件:                                                  │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
│  │  RocketMQ   │  │  Nacos      │  │  Sentinel   │     │
│  │  消息队列    │  │  服务注册    │  │  流控降级    │     │
│  └─────────────┘  └─────────────┘  └─────────────┘     │
└─────────────────────────────────────────────────────────┘
```

---

## 三、AI能力平台详细设计

### 3.1 技术架构

```
┌─────────────────────────────────────────────────────────────┐
│                AI能力平台架构                                  │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  接入层:                                                      │
│  ┌──────────────────────────────────────────────────────┐   │
│  │  API Gateway (FastAPI统一入口)                        │   │
│  │  - RESTful API                                        │   │
│  │  - WebSocket（流式输出）                              │   │
│  │  - 接口鉴权（API Key）                                │   │
│  └──────────────────────────────────────────────────────┘   │
│                                                               │
│  编排层:                                                      │
│  ┌──────────────────────────────────────────────────────┐   │
│  │  对话编排服务 (LangChain)                             │   │
│  │  - 意图识别                                            │   │
│  │  - 多轮对话管理                                        │   │
│  │  - 上下文维护                                          │   │
│  │  - Agent调度（可选）                                   │   │
│  └──────────────────────────────────────────────────────┘   │
│                                                               │
│  核心能力层:                                                  │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │  LLM服务    │  │  RAG引擎    │  │  知识库服务  │         │
│  │  ┌────────┐ │  │  ┌────────┐ │  │  ┌────────┐ │         │
│  │  │云端API │ │  │  │Query改写│ │  │  │知识CRUD│ │         │
│  │  │OpenAI  │ │  │  │混合检索 │ │  │  │向量化  │ │         │
│  │  │通义千问│ │  │  │重排序  │ │  │  │版本管理│ │         │
│  │  └────────┘ │  │  └────────┘ │  │  └────────┘ │         │
│  │  ┌────────┐ │  │             │  │             │         │
│  │  │本地模型│ │  │             │  │             │         │
│  │  │Qwen-7B │ │  │             │  │             │         │
│  │  │ChatGLM │ │  │             │  │             │         │
│  │  └────────┘ │  │             │  │             │         │
│  │  ┌────────┐ │  │             │  │             │         │
│  │  │路由策略│ │  │             │  │             │         │
│  │  │智能切换│ │  │             │  │             │         │
│  │  └────────┘ │  │             │  │             │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │  Embedding  │  │  Agent服务  │  │  Prompt管理  │         │
│  │  - BGE-M3   │  │  - 工具编排 │  │  - 模板库   │         │
│  │  - 向量生成 │  │  - 多步推理 │  │  - 版本控制 │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
│                                                               │
│  数据层:                                                      │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │  Milvus     │  │  Elasticsearch│ │  PostgreSQL │         │
│  │  向量数据库  │  │  全文检索    │  │  结构化数据 │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
│  ┌─────────────┐  ┌─────────────┐                           │
│  │  Redis      │  │  MinIO      │                           │
│  │  缓存+上下文 │  │  文件存储   │                           │
│  └─────────────┘  └─────────────┘                           │
└─────────────────────────────────────────────────────────────┘
```
